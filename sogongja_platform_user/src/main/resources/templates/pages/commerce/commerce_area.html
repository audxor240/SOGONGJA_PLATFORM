<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:include="fragments/common_meta"></th:block>
    <title>소공자플랫폼 상점연구소</title>
    <meta property="og:url" content="">
    <meta property="og:title" content="소공자 플랫폼 | 상권연구소">
    <meta property="og:image" th:content="@{/images/bg-maintext1.png}">
    <meta property="og:description" content="소공자 플랫폼 상권연구소">
    <meta name="keywords" content="소공자 플랫폼, 상권연구소, 상권분석정보, 상권특성정보, 지역특성정보">
    <meta name="description" content="소공자 플랫폼 상권연구소">
    <!--/* Common css */-->
    <th:block th:include="fragments/common_css"></th:block>
</head>

<body class="area">
<article>
    <div th:replace="~{fragments/header :: header}"></div>
    <div id="map_wrap">
        <div id="map"></div>
    </div>
</article>

<div class="wrap-loading display-none">
    <div><img th:src="@{/images/ajax-loading.gif}" alt="로딩중" /></div>
</div>
<th:block th:include="fragments/common_js"></th:block>
<!-- 지도를 표시할 div 입니다 -->

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=21e6944cf244415210a4c4474a6327ca"></script>
<script>

    var mapDefaultLevel = 5;
    var clientLatitude = 37.49068266308499;
    var clientLongitude = 127.05611940441852;
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(clientLatitude, clientLongitude), // 지도의 중심좌표
            level: mapDefaultLevel // 지도의 확대 레벨
        };

    // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var mapWidth =  mapContainer.style.width;
    var mapHeight =  mapContainer.style.height;
    console.log("width : "  + mapWidth + ", height : " + mapHeight)
    console.log("lat : " + map.getCenter().getLat() + " lng : " + map.getCenter().getLng()+ " x1 : " + map.getBounds().getSouthWest().getLat() + " x2 : " + map.getBounds().getNorthEast().getLat() + " y1 : " + map.getBounds().getSouthWest().getLng() + " y2 : " + map.getBounds().getNorthEast().getLng())

    var circles = [];
    var clicked = false;

    kakao.maps.event.addListener(map, 'mousemove', function(mouseEvent) {
        if (!clicked) {
            for (var i = 0; i < circles.length; i++) {
                circles[i].setMap(null);
            }

            var circle = new kakao.maps.Circle({
                center : mouseEvent.latLng,  // 원의 중심좌표 입니다
                radius: 300, // 미터 단위의 원의 반지름입니다
                strokeWeight: 5, // 선의 두께입니다
                strokeColor: '#75B8FA', // 선의 색깔입니다
                strokeOpacity: 1, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
                strokeStyle: 'dashed', // 선의 스타일 입니다
                fillColor: '#CFE7FF', // 채우기 색깔입니다
                fillOpacity: 0.7  // 채우기 불투명도 입니다
            });

            circles.push(circle);
            circle.setMap(map);

        }
    });

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        if (clicked) {
            clicked = false;

            map.setCenter(mouseEvent.latLng);
            map.setLevel(5);

        } else {
            console.log("lat : " + map.getCenter().getLat() + " lng : " + map.getCenter().getLng()+ " x1 : " + map.getBounds().getSouthWest().getLat() + " x2 : " + map.getBounds().getNorthEast().getLat() + " y1 : " + map.getBounds().getSouthWest().getLng() + " y2 : " + map.getBounds().getNorthEast().getLng())
            clicked = true;

            map.setCenter(mouseEvent.latLng);
            map.setLevel(3);

            var test = 'test';
            var data = {
                test : test
            }

            ajaxPostSyn('/commerce/area-heatmap', data, function (result) {

            })
        }
    });

    //ajax 요청하는 함수
    function ajaxPostSyn(url, data, callback, showLoading) {
        // IE 기본값세팅
        showLoading = typeof showLoading !== 'undefined' ? showLoading : true;
        $.ajax({
            //async:true,
            url: contextPath + url, data: JSON.stringify(data), method: "POST", success: function (result) {
                console.log('result : ', result);
                if (callback) {
                    callback(result);
                }
            }, beforeSend: function () {
                if (showLoading) {
                    $('.wrap-loading').removeClass('display-none');
                }
            }, complete: function () {
                if (showLoading) {
                    $('.wrap-loading').addClass('display-none');
                }
            }, error: function (xhr, status, error) {
                console.error('error : ', error);
            }
        });
    }
</script>
</body>
</html>